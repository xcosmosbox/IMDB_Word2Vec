# =============================================================================
# Flyway 数据库迁移配置
# 
# 项目：生成式推荐系统
# 模块：数据库管理
# 版本：1.0.0
# =============================================================================

# -----------------------------------------------------------------------------
# 数据库连接配置
# -----------------------------------------------------------------------------
flyway.url=jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:recommend}
flyway.user=${POSTGRES_USER:postgres}
flyway.password=${POSTGRES_PASSWORD}

# -----------------------------------------------------------------------------
# 迁移文件配置
# -----------------------------------------------------------------------------
# 迁移文件位置
flyway.locations=filesystem:./migrations

# 迁移文件编码
flyway.encoding=UTF-8

# SQL 迁移文件前缀
flyway.sqlMigrationPrefix=V

# SQL 迁移文件分隔符
flyway.sqlMigrationSeparator=__

# SQL 迁移文件后缀
flyway.sqlMigrationSuffixes=.sql

# -----------------------------------------------------------------------------
# 迁移行为配置
# -----------------------------------------------------------------------------
# 是否允许混合迁移（版本迁移和可重复迁移混合）
flyway.mixed=false

# 是否允许非按顺序迁移
flyway.outOfOrder=false

# 是否在运行迁移前先验证已应用的迁移
flyway.validateOnMigrate=true

# 是否在执行迁移前先清理数据库（仅开发环境使用）
flyway.cleanDisabled=true

# 基线版本
flyway.baselineVersion=0

# 基线描述
flyway.baselineDescription=Baseline

# 当目标数据库非空时是否设置基线
flyway.baselineOnMigrate=true

# -----------------------------------------------------------------------------
# Schema 配置
# -----------------------------------------------------------------------------
# 默认 Schema
flyway.defaultSchema=public

# 管理 Schema（用于存储 Flyway 元数据）
flyway.schemas=public

# 迁移历史表名
flyway.table=flyway_schema_history

# -----------------------------------------------------------------------------
# 占位符配置
# -----------------------------------------------------------------------------
# 是否启用占位符替换
flyway.placeholderReplacement=true

# 占位符前缀
flyway.placeholderPrefix=${

# 占位符后缀
flyway.placeholderSuffix=}

# 自定义占位符
flyway.placeholders.schema_name=public
flyway.placeholders.env=dev

# -----------------------------------------------------------------------------
# 连接池配置
# -----------------------------------------------------------------------------
# 连接超时（秒）
flyway.connectRetries=3
flyway.connectRetriesInterval=120

# -----------------------------------------------------------------------------
# 回调配置
# -----------------------------------------------------------------------------
# 迁移前后的回调脚本
# flyway.callbacks=my.package.MyCallback

# -----------------------------------------------------------------------------
# 高级配置
# -----------------------------------------------------------------------------
# 是否启用批量执行（提升性能）
flyway.batch=true

# 锁定重试次数
flyway.lockRetryCount=50

# 是否创建 Schema（如果不存在）
flyway.createSchemas=true

# 执行组（用于标识迁移组）
flyway.group=recommend-system

