{{/* ==========================================================================
     Slack å‘Šè­¦æ¨¡æ¿
     
     ç”¨äºæ ¼å¼åŒ–å‘é€åˆ° Slack çš„å‘Šè­¦æ¶ˆæ¯
     ========================================================================== */}}

{{/* å‘Šè­¦æ ‡é¢˜ */}}
{{ define "slack.title" -}}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " | " }}
{{- end }}

{{/* å‘Šè­¦è¯¦ç»†å†…å®¹ */}}
{{ define "slack.text" -}}
{{ range .Alerts -}}
*å‘Šè­¦åç§°:* {{ .Labels.alertname }}
*ä¸¥é‡çº§åˆ«:* {{ .Labels.severity | toUpper }}
*æœåŠ¡:* {{ .Labels.service | default "N/A" }}
*çŠ¶æ€:* {{ .Status }}
*å¼€å§‹æ—¶é—´:* {{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}
{{ if eq .Status "resolved" -}}
*æ¢å¤æ—¶é—´:* {{ .EndsAt.Format "2006-01-02 15:04:05 MST" }}
{{ end -}}

*æ‘˜è¦:* {{ .Annotations.summary }}
*è¯¦æƒ…:* {{ .Annotations.description }}

{{ if .Annotations.runbook_url -}}
ğŸ“– <{{ .Annotations.runbook_url }}|Runbook>
{{ end -}}
{{ if .Annotations.dashboard_url -}}
ğŸ“Š <{{ .Annotations.dashboard_url }}|Dashboard>
{{ end -}}
---
{{ end -}}
{{- end }}

{{/* å‘Šè­¦é¢œè‰² */}}
{{ define "slack.color" -}}
{{ if eq .Status "firing" -}}
    {{ if eq .CommonLabels.severity "critical" -}}
    danger
    {{- else if eq .CommonLabels.severity "warning" -}}
    warning
    {{- else -}}
    #439FE0
    {{- end -}}
{{- else -}}
good
{{- end -}}
{{- end }}

{{/* Dashboard URL */}}
{{ define "slack.dashboard_url" -}}
{{ if .CommonAnnotations.dashboard_url -}}
{{ .CommonAnnotations.dashboard_url }}
{{- else -}}
https://grafana.example.com/d/overview
{{- end -}}
{{- end }}

{{/* Runbook URL */}}
{{ define "slack.runbook_url" -}}
{{ if .CommonAnnotations.runbook_url -}}
{{ .CommonAnnotations.runbook_url }}
{{- else -}}
https://wiki.example.com/runbooks
{{- end -}}
{{- end }}

{{/* ==========================================================================
     PagerDuty æ¨¡æ¿
     ========================================================================== */}}

{{/* PagerDuty æè¿° */}}
{{ define "pagerduty.description" -}}
[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}: {{ .CommonAnnotations.summary }}
{{- end }}

{{/* PagerDuty è§¦å‘å‘Šè­¦åˆ—è¡¨ */}}
{{ define "pagerduty.firing" -}}
{{ range .Alerts.Firing -}}
- {{ .Labels.alertname }}: {{ .Annotations.summary }}
{{ end -}}
{{- end }}

{{/* PagerDuty å·²è§£å†³å‘Šè­¦åˆ—è¡¨ */}}
{{ define "pagerduty.resolved" -}}
{{ range .Alerts.Resolved -}}
- {{ .Labels.alertname }}: {{ .Annotations.summary }}
{{ end -}}
{{- end }}

{{/* ==========================================================================
     é‚®ä»¶æ¨¡æ¿
     ========================================================================== */}}

{{/* é‚®ä»¶ä¸»é¢˜ */}}
{{ define "email.subject" -}}
{{ .GroupLabels.alertname }} - {{ .Status | toUpper }}
{{- end }}

{{/* é‚®ä»¶ HTML å†…å®¹ */}}
{{ define "email.html" -}}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            padding: 20px;
            color: white;
        }
        .header.critical {
            background-color: #dc3545;
        }
        .header.warning {
            background-color: #ffc107;
            color: #333;
        }
        .header.resolved {
            background-color: #28a745;
        }
        .content {
            padding: 20px;
        }
        .alert-item {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }
        .alert-item:last-child {
            border-bottom: none;
        }
        .label {
            font-weight: bold;
            color: #666;
            display: inline-block;
            width: 100px;
        }
        .value {
            color: #333;
        }
        .footer {
            background-color: #f8f9fa;
            padding: 15px 20px;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        a.button {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header {{ if eq .Status "firing" }}{{ if eq .CommonLabels.severity "critical" }}critical{{ else }}warning{{ end }}{{ else }}resolved{{ end }}">
            <h2 style="margin: 0;">
                {{ if eq .Status "firing" }}ğŸš¨{{ else }}âœ…{{ end }}
                {{ .GroupLabels.alertname }}
            </h2>
            <p style="margin: 10px 0 0 0;">çŠ¶æ€: {{ .Status | toUpper }}</p>
        </div>
        
        <div class="content">
            {{ range .Alerts }}
            <div class="alert-item">
                <p><span class="label">å‘Šè­¦åç§°:</span> <span class="value">{{ .Labels.alertname }}</span></p>
                <p><span class="label">ä¸¥é‡çº§åˆ«:</span> <span class="value">{{ .Labels.severity }}</span></p>
                <p><span class="label">æœåŠ¡:</span> <span class="value">{{ .Labels.service | default "N/A" }}</span></p>
                <p><span class="label">å¼€å§‹æ—¶é—´:</span> <span class="value">{{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}</span></p>
                {{ if eq .Status "resolved" }}
                <p><span class="label">æ¢å¤æ—¶é—´:</span> <span class="value">{{ .EndsAt.Format "2006-01-02 15:04:05 MST" }}</span></p>
                {{ end }}
                <p><span class="label">æ‘˜è¦:</span></p>
                <p class="value">{{ .Annotations.summary }}</p>
                <p><span class="label">è¯¦æƒ…:</span></p>
                <p class="value">{{ .Annotations.description }}</p>
            </div>
            {{ end }}
            
            <div style="text-align: center; margin-top: 20px;">
                {{ if .CommonAnnotations.dashboard_url }}
                <a href="{{ .CommonAnnotations.dashboard_url }}" class="button">ğŸ“Š æŸ¥çœ‹ Dashboard</a>
                {{ end }}
                {{ if .CommonAnnotations.runbook_url }}
                <a href="{{ .CommonAnnotations.runbook_url }}" class="button">ğŸ“– æŸ¥çœ‹ Runbook</a>
                {{ end }}
            </div>
        </div>
        
        <div class="footer">
            <p>æ­¤é‚®ä»¶ç”± AlertManager è‡ªåŠ¨å‘é€</p>
            <p>æ¨èç³»ç»Ÿç›‘æ§å¹³å° | {{ now.Format "2006-01-02 15:04:05" }}</p>
        </div>
    </div>
</body>
</html>
{{- end }}

{{/* ==========================================================================
     ä¼ä¸šå¾®ä¿¡æ¨¡æ¿ (å¯é€‰)
     ========================================================================== */}}

{{ define "wechat.message" -}}
{{ if eq .Status "firing" }}ğŸš¨{{ else }}âœ…{{ end }} **{{ .GroupLabels.alertname }}**

**çŠ¶æ€:** {{ .Status | toUpper }}
**ä¸¥é‡çº§åˆ«:** {{ .CommonLabels.severity }}

{{ range .Alerts -}}
---
**æœåŠ¡:** {{ .Labels.service | default "N/A" }}
**æ‘˜è¦:** {{ .Annotations.summary }}
**è¯¦æƒ…:** {{ .Annotations.description }}
**æ—¶é—´:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ end -}}

[æŸ¥çœ‹è¯¦æƒ…]({{ template "slack.dashboard_url" . }})
{{- end }}

{{/* ==========================================================================
     é’‰é’‰æ¨¡æ¿ (å¯é€‰)
     ========================================================================== */}}

{{ define "dingtalk.message" -}}
{
    "msgtype": "markdown",
    "markdown": {
        "title": "{{ .GroupLabels.alertname }}",
        "text": "{{ if eq .Status "firing" }}### ğŸš¨ å‘Šè­¦è§¦å‘{{ else }}### âœ… å‘Šè­¦æ¢å¤{{ end }}\n\n**å‘Šè­¦åç§°:** {{ .GroupLabels.alertname }}\n\n**çŠ¶æ€:** {{ .Status | toUpper }}\n\n**ä¸¥é‡çº§åˆ«:** {{ .CommonLabels.severity }}\n\n{{ range .Alerts }}---\n\n**æœåŠ¡:** {{ .Labels.service | default "N/A" }}\n\n**æ‘˜è¦:** {{ .Annotations.summary }}\n\n**è¯¦æƒ…:** {{ .Annotations.description }}\n\n{{ end }}"
    }
}
{{- end }}

