# 生产环境副本数配置
# 确保高可用性
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: recommend-service
spec:
  replicas: 5
  template:
    spec:
      # 强制反亲和性 - 确保分布在不同节点
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: recommend-service
              topologyKey: kubernetes.io/hostname
        # 跨可用区分布
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 100
              podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: recommend-service
                topologyKey: topology.kubernetes.io/zone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  template:
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: user-service
              topologyKey: kubernetes.io/hostname
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: item-service
spec:
  replicas: 3
  template:
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: item-service
              topologyKey: kubernetes.io/hostname
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ugt-inference
spec:
  replicas: 2
  template:
    spec:
      # GPU Pod 分布在不同的 GPU 节点
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: ugt-inference
              topologyKey: kubernetes.io/hostname
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-app
spec:
  replicas: 3
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: admin-app
spec:
  replicas: 2

