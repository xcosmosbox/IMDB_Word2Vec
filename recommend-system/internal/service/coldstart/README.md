# å†·å¯åŠ¨æœåŠ¡æ¨¡å—

> åŸºäº LLM çš„æ¨èç³»ç»Ÿå†·å¯åŠ¨è§£å†³æ–¹æ¡ˆ

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [API å‚è€ƒ](#api-å‚è€ƒ)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
- [é™çº§ç­–ç•¥](#é™çº§ç­–ç•¥)
- [æµ‹è¯•](#æµ‹è¯•)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¦‚è¿°

å†·å¯åŠ¨æœåŠ¡è§£å†³æ¨èç³»ç»Ÿä¸­çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼šå½“ç”¨æˆ·æˆ–ç‰©å“ç¼ºä¹å†å²æ•°æ®æ—¶ï¼Œå¦‚ä½•æä¾›é«˜è´¨é‡çš„æ¨èã€‚

### æ ¸å¿ƒåŠŸèƒ½

- ğŸ†• **æ–°ç”¨æˆ·å†·å¯åŠ¨**ï¼šåŸºäºç”¨æˆ·å±æ€§ç”Ÿæˆåˆå§‹åå¥½ç”»åƒ
- ğŸ“¦ **æ–°ç‰©å“å†·å¯åŠ¨**ï¼šåˆ†æç‰©å“å†…å®¹ç”Ÿæˆç‰¹å¾å’ŒåµŒå…¥å‘é‡
- ğŸ¯ **å†·å¯åŠ¨æ¨è**ï¼šä¸ºç¼ºä¹å†å²çš„ç”¨æˆ·æä¾›ä¸ªæ€§åŒ–æ¨è
- ğŸ’¬ **æ¨èè§£é‡Š**ï¼šç”Ÿæˆå¯è§£é‡Šçš„æ¨èç†ç”±

### æŠ€æœ¯ç‰¹ç‚¹

- åˆ©ç”¨ LLM çš„ä¸–ç•ŒçŸ¥è¯†ç”Ÿæˆè¯­ä¹‰å…ˆéªŒ
- æ”¯æŒå¤šç§ LLM åç«¯ï¼ˆOpenAIã€æœ¬åœ°æ¨¡å‹ç­‰ï¼‰
- è‡ªåŠ¨é™çº§ç­–ç•¥ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨æ€§
- ç»“æœç¼“å­˜ï¼Œå‡å°‘ LLM è°ƒç”¨æˆæœ¬

---

## æ ¸å¿ƒæ¦‚å¿µ

### å†·å¯åŠ¨é—®é¢˜

å†·å¯åŠ¨æ˜¯æ¨èç³»ç»Ÿé¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š

| ç±»å‹ | æè¿° | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **æ–°ç”¨æˆ·** | ç”¨æˆ·æ— å†å²è¡Œä¸º | LLM åˆ†æç”¨æˆ·å±æ€§ç”Ÿæˆåå¥½ |
| **æ–°ç‰©å“** | ç‰©å“æ— è¢«äº¤äº’è®°å½• | LLM åˆ†æç‰©å“å†…å®¹ç”Ÿæˆç‰¹å¾ |
| **ç³»ç»Ÿå†·å¯åŠ¨** | æ•´ä¸ªç³»ç»Ÿæ— æ•°æ® | ç»“åˆ LLM ä¸çƒ­é—¨æ¨è |

### ä¸‰å±‚è§£å†³ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 1: è¯­ä¹‰å…ˆéªŒ (Semantic Prior)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åˆ©ç”¨ LLM çš„ä¸–ç•ŒçŸ¥è¯†ç”Ÿæˆåˆå§‹è¡¨ç¤º                          â”‚    â”‚
â”‚  â”‚  - æ–°ç”¨æˆ·: åŸºäºå¹´é¾„ã€æ€§åˆ«ç­‰å±æ€§æ¨æµ‹åå¥½                    â”‚    â”‚
â”‚  â”‚  - æ–°ç‰©å“: åŸºäºæ ‡é¢˜ã€æè¿°ç­‰å†…å®¹åˆ†æç‰¹å¾                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 2: è·¨åŸŸè¿ç§» (Cross-Domain)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åˆ©ç”¨ç›¸ä¼¼å®ä½“çš„å·²æœ‰è¡¨ç¤º                                   â”‚    â”‚
â”‚  â”‚  - åŸºäºåå¥½ç±»åˆ«æŸ¥æ‰¾ç›¸ä¼¼ç”¨æˆ·ç¾¤                             â”‚    â”‚
â”‚  â”‚  - åŸºäºåµŒå…¥å‘é‡æŸ¥æ‰¾ç›¸ä¼¼ç‰©å“                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 3: å¿«é€Ÿé€‚åº” (Rapid Adaptation)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åŸºäºå°‘é‡äº¤äº’å¿«é€Ÿæ›´æ–°è¡¨ç¤º                                 â”‚    â”‚
â”‚  â”‚  - ç¼“å­˜å†·å¯åŠ¨ç»“æœï¼Œåç»­å¯å¢é‡æ›´æ–°                         â”‚    â”‚
â”‚  â”‚  - ä¸ä¸»æ¨èç³»ç»Ÿåä½œè¿›è¡Œåœ¨çº¿å­¦ä¹                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ColdStartService                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚    Config    â”‚ â”€â”€â”€ æœåŠ¡é…ç½®                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     æ ¸å¿ƒæ–¹æ³•                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ HandleNewUser   â”‚ â”‚ HandleNewItem   â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ GetColdStart    â”‚ â”‚ Explain         â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ Recommendations â”‚ â”‚ Recommendation  â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ä¾èµ–ç»„ä»¶                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚   LLM   â”‚ â”‚ UserRepo â”‚ â”‚ ItemRepo â”‚ â”‚ Cache â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ Client  â”‚ â”‚          â”‚ â”‚          â”‚ â”‚       â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæœåŠ¡

```go
import (
    "recommend-system/internal/llm"
    "recommend-system/internal/service/coldstart"
    "recommend-system/internal/interfaces"
)

// åˆ›å»º LLM å®¢æˆ·ç«¯
llmClient, _ := llm.NewOpenAIClient(llm.OpenAIConfig{
    APIKey: "your-api-key",
})

// åˆ›å»ºå†·å¯åŠ¨æœåŠ¡
service := coldstart.NewService(
    coldstart.DefaultConfig(),
    llmClient,
    userRepo,      // UserRepository å®ç°
    itemRepo,      // ItemRepository å®ç°
    cache,         // Cache å®ç°
    logger,        // zap.Logger
)
```

### 2. å¤„ç†æ–°ç”¨æˆ·å†·å¯åŠ¨

```go
user := &interfaces.User{
    ID:     "new_user_001",
    Age:    25,
    Gender: "male",
}

result, err := service.HandleNewUser(ctx, user)
if err != nil {
    log.Fatal(err)
}

// ç»“æœåŒ…å«ç”¨æˆ·åå¥½å’Œåˆå§‹æ¨è
fmt.Printf("åå¥½: %v\n", result.Preferences)
fmt.Printf("æ¨è: %v\n", result.Recommendations)
fmt.Printf("ç­–ç•¥: %s\n", result.Strategy)
```

### 3. å¤„ç†æ–°ç‰©å“å†·å¯åŠ¨

```go
item := &interfaces.Item{
    ID:          "new_item_001",
    Title:       "æ™ºèƒ½æ‰‹æœº Pro Max",
    Description: "æœ€æ–°æ¬¾æ——èˆ°æ™ºèƒ½æ‰‹æœºï¼Œæ­è½½å…ˆè¿›èŠ¯ç‰‡",
    Category:    "ç§‘æŠ€",
    Tags:        []string{"æ‰‹æœº", "æ™ºèƒ½è®¾å¤‡", "æ•°ç "},
}

result, err := service.HandleNewItem(ctx, item)
if err != nil {
    log.Fatal(err)
}

// ç»“æœåŒ…å«ç‰©å“ç‰¹å¾å’Œç›¸ä¼¼ç‰©å“
fmt.Printf("ç‰¹å¾: %v\n", result.Features)
fmt.Printf("åµŒå…¥å‘é‡ç»´åº¦: %d\n", len(result.Embedding))
fmt.Printf("ç›¸ä¼¼ç‰©å“: %v\n", result.SimilarItems)
```

### 4. è·å–å†·å¯åŠ¨æ¨è

```go
items, err := service.GetColdStartRecommendations(ctx, "user_001", 20)
if err != nil {
    log.Fatal(err)
}

for _, item := range items {
    fmt.Printf("æ¨è: %s - %s\n", item.ID, item.Title)
}
```

### 5. ç”Ÿæˆæ¨èè§£é‡Š

```go
explanation, err := service.ExplainRecommendation(ctx, "user_001", "item_001")
if err != nil {
    log.Fatal(err)
}

fmt.Printf("æ¨èç†ç”±: %s\n", explanation)
// è¾“å‡º: "æ ¹æ®æ‚¨å¯¹ç§‘æŠ€äº§å“çš„å…´è¶£ï¼Œä¸ºæ‚¨æ¨èè¿™æ¬¾æ™ºèƒ½æ‰‹æœº"
```

---

## API å‚è€ƒ

### ColdStartService æ¥å£

```go
type ColdStartService interface {
    // HandleNewUser å¤„ç†æ–°ç”¨æˆ·å†·å¯åŠ¨
    HandleNewUser(ctx context.Context, user *User) (*ColdStartResult, error)

    // HandleNewItem å¤„ç†æ–°ç‰©å“å†·å¯åŠ¨
    HandleNewItem(ctx context.Context, item *Item) (*ItemColdStartResult, error)

    // GetColdStartRecommendations è·å–å†·å¯åŠ¨æ¨è
    GetColdStartRecommendations(ctx context.Context, userID string, limit int) ([]*Item, error)

    // ExplainRecommendation ç”Ÿæˆæ¨èè§£é‡Š
    ExplainRecommendation(ctx context.Context, userID, itemID string) (string, error)
}
```

### ColdStartResult ç»“æ„

```go
type ColdStartResult struct {
    UserID          string                 // ç”¨æˆ· ID
    Preferences     map[string]interface{} // ç”¨æˆ·åå¥½
    Recommendations []string               // æ¨èç‰©å“ ID åˆ—è¡¨
    Strategy        string                 // ä½¿ç”¨çš„ç­–ç•¥
    CreatedAt       time.Time              // åˆ›å»ºæ—¶é—´
}
```

### ItemColdStartResult ç»“æ„

```go
type ItemColdStartResult struct {
    ItemID       string                 // ç‰©å“ ID
    Features     map[string]interface{} // ç‰©å“ç‰¹å¾
    Embedding    []float32              // åµŒå…¥å‘é‡
    SimilarItems []string               // ç›¸ä¼¼ç‰©å“ ID åˆ—è¡¨
    Strategy     string                 // ä½¿ç”¨çš„ç­–ç•¥
    CreatedAt    time.Time              // åˆ›å»ºæ—¶é—´
}
```

---

## é…ç½®è¯´æ˜

```go
type Config struct {
    // CacheTTL ç¼“å­˜è¿‡æœŸæ—¶é—´
    CacheTTL time.Duration `json:"cache_ttl" yaml:"cache_ttl"`

    // MaxRecommendations æœ€å¤§æ¨èæ•°é‡
    MaxRecommendations int `json:"max_recommendations" yaml:"max_recommendations"`

    // LLMTimeout LLM è¯·æ±‚è¶…æ—¶æ—¶é—´
    LLMTimeout time.Duration `json:"llm_timeout" yaml:"llm_timeout"`

    // EnableLLMFallback æ˜¯å¦å¯ç”¨ LLM é™çº§
    EnableLLMFallback bool `json:"enable_llm_fallback" yaml:"enable_llm_fallback"`

    // DefaultCategories é»˜è®¤æ¨èç±»åˆ«
    DefaultCategories []string `json:"default_categories" yaml:"default_categories"`

    // PopularItemsLimit çƒ­é—¨ç‰©å“é™åˆ¶æ•°
    PopularItemsLimit int `json:"popular_items_limit" yaml:"popular_items_limit"`
}
```

### é»˜è®¤é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| CacheTTL | 24h | å†·å¯åŠ¨ç»“æœç¼“å­˜ 24 å°æ—¶ |
| MaxRecommendations | 50 | å•æ¬¡æœ€å¤šè¿”å› 50 ä¸ªæ¨è |
| LLMTimeout | 30s | LLM è¯·æ±‚è¶…æ—¶ 30 ç§’ |
| EnableLLMFallback | true | å¯ç”¨é™çº§ç­–ç•¥ |
| DefaultCategories | ["çƒ­é—¨", "æ¨è", "æ–°å“"] | é»˜è®¤æ¨èç±»åˆ« |
| PopularItemsLimit | 100 | ä»æ¯ä¸ªç±»åˆ«è·å–æœ€å¤š 100 ä¸ªçƒ­é—¨ç‰©å“ |

---

## å·¥ä½œæµç¨‹

### æ–°ç”¨æˆ·å†·å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ–°ç”¨æˆ·å†·å¯åŠ¨æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. æ¥æ”¶ç”¨æˆ·ä¿¡æ¯                                                  â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  2. æ„å»º LLM æç¤ºè¯                                               â”‚
â”‚     â”‚ - åŒ…å«ç”¨æˆ·å¹´é¾„ã€æ€§åˆ«ç­‰å±æ€§                                   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  3. è°ƒç”¨ LLM åˆ†æåå¥½                                             â”‚
â”‚     â”‚ - è¿”å› JSON æ ¼å¼çš„åå¥½åˆ†æ                                  â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€ æˆåŠŸ â”€â”€â”€â”€â”                                             â”‚
â”‚     â”‚              â–¼                                             â”‚
â”‚     â”‚         4. è§£æåå¥½                                         â”‚
â”‚     â”‚              â”‚                                             â”‚
â”‚     â”‚              â–¼                                             â”‚
â”‚     â”‚         5. åŸºäºåå¥½è·å–æ¨è                                  â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€ å¤±è´¥ â”€â”€â”€â”€â”                                             â”‚
â”‚     â”‚              â–¼                                             â”‚
â”‚     â”‚         6. é™çº§ï¼šåŸºäºäººå£ç»Ÿè®¡ç‰¹å¾                            â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  7. ç¼“å­˜ç»“æœ                                                      â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  8. è¿”å›å†·å¯åŠ¨ç»“æœ                                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LLM åå¥½åˆ†æç¤ºä¾‹

**è¾“å…¥æç¤ºè¯ï¼š**
```
è¯·åˆ†æä»¥ä¸‹ç”¨æˆ·çš„å¯èƒ½åå¥½ï¼š

- ç”¨æˆ·ID: user_001
- å¹´é¾„: 25å²
- æ€§åˆ«: male

è¯·è¿”å› JSON æ ¼å¼çš„åå¥½åˆ†æç»“æœã€‚
```

**LLM è¾“å‡ºï¼š**
```json
{
    "preferred_categories": ["ç§‘æŠ€", "æ¸¸æˆ", "å¨±ä¹"],
    "preferred_tags": ["æ–°å“", "çƒ­é—¨", "æ•°ç "],
    "content_preference": "medium",
    "price_sensitivity": "low"
}
```

---

## é™çº§ç­–ç•¥

å½“ LLM è°ƒç”¨å¤±è´¥æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé™çº§ç­–ç•¥ï¼š

### ç”¨æˆ·å†·å¯åŠ¨é™çº§

```go
// åŸºäºå¹´é¾„ç”Ÿæˆé»˜è®¤åå¥½
switch {
case age < 18:
    categories = ["åŠ¨æ¼«", "æ¸¸æˆ", "å­¦ä¹ "]
case age < 25:
    categories = ["ç§‘æŠ€", "æ¸¸æˆ", "å¨±ä¹", "æ—¶å°š"]
case age < 35:
    categories = ["å•†ä¸š", "ç§‘æŠ€", "ç”Ÿæ´»", "ç†è´¢"]
case age < 50:
    categories = ["å•†ä¸š", "æ–°é—»", "å¥åº·", "å®¶åº­"]
default:
    categories = ["å¥åº·", "æ–°é—»", "æ–‡åŒ–", "å…»ç”Ÿ"]
}

// åŸºäºæ€§åˆ«è°ƒæ•´
if gender == "female":
    tags = ["æ—¶å°š", "ç¾å¦†", "ç”Ÿæ´»"]
else if gender == "male":
    tags = ["ç§‘æŠ€", "è¿åŠ¨", "æ±½è½¦"]
```

### ç‰©å“å†·å¯åŠ¨é™çº§

- ç›´æ¥ä½¿ç”¨ç‰©å“çš„ Category å’Œ Tags ä½œä¸ºç‰¹å¾
- åŸºäºåŒç±»åˆ«æŸ¥æ‰¾çƒ­é—¨ç‰©å“ä½œä¸ºç›¸ä¼¼ç‰©å“
- ä¸ç”ŸæˆåµŒå…¥å‘é‡

---

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test -v ./internal/service/coldstart/...

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -v ./internal/service/coldstart/ -run TestService_HandleNewUser

# æµ‹è¯•è¦†ç›–ç‡
go test -cover ./internal/service/coldstart/...
```

### Mock ä¾èµ–

æµ‹è¯•æ–‡ä»¶ä¸­æä¾›äº†å®Œæ•´çš„ Mock å®ç°ï¼š

```go
// Mock LLM å®¢æˆ·ç«¯
type mockLLMClient struct {
    completeFunc func(...) (string, error)
    embedFunc    func(...) ([]float32, error)
    chatFunc     func(...) (string, error)
}

// Mock ç”¨æˆ·ä»“åº“
type mockUserRepository struct { ... }

// Mock ç‰©å“ä»“åº“
type mockItemRepository struct { ... }

// Mock ç¼“å­˜
type mockCache struct { ... }
```

---

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```go
result, err := service.HandleNewUser(ctx, user)
if err != nil {
    // è®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æœåŠ¡
    logger.Warn("cold start failed", zap.Error(err))
    
    // è¿”å›é»˜è®¤æ¨è
    return getDefaultRecommendations()
}
```

### 2. è¶…æ—¶æ§åˆ¶

```go
// ä¸ºå†·å¯åŠ¨è®¾ç½®ä¸“ç”¨è¶…æ—¶
ctx, cancel := context.WithTimeout(ctx, 60*time.Second)
defer cancel()

result, err := service.HandleNewUser(ctx, user)
```

### 3. ç¼“å­˜ç­–ç•¥

```go
// é…ç½®åˆé€‚çš„ç¼“å­˜æ—¶é—´
cfg := coldstart.Config{
    CacheTTL: 24 * time.Hour,  // 24 å°æ—¶åé‡æ–°åˆ†æ
}

// æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜ï¼ˆå½“ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶ï¼‰
cache.Delete(ctx, "coldstart:user:" + userID)
```

### 4. ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| `coldstart_user_total` | ç”¨æˆ·å†·å¯åŠ¨æ€»æ¬¡æ•° |
| `coldstart_item_total` | ç‰©å“å†·å¯åŠ¨æ€»æ¬¡æ•° |
| `coldstart_llm_success_rate` | LLM è°ƒç”¨æˆåŠŸç‡ |
| `coldstart_fallback_rate` | é™çº§ç­–ç•¥ä½¿ç”¨ç‡ |
| `coldstart_latency` | å†·å¯åŠ¨å»¶è¿Ÿ |

### 5. éšç§ä¿æŠ¤

- ä¸è¦å°†æ•æ„Ÿç”¨æˆ·ä¿¡æ¯å‘é€ç»™ LLM
- ä»…ä½¿ç”¨è„±æ•åçš„å±æ€§ï¼ˆå¹´é¾„æ®µã€æ€§åˆ«ç­‰ï¼‰
- å®šæœŸæ¸…ç†ç¼“å­˜ä¸­çš„ç”¨æˆ·æ•°æ®

---

## æ–‡ä»¶ç»“æ„

```
internal/service/coldstart/
â”œâ”€â”€ service.go       # æœåŠ¡å®ç°
â”œâ”€â”€ service_test.go  # å•å…ƒæµ‹è¯•
â””â”€â”€ README.md        # æœ¬æ–‡æ¡£
```

---

## ä¾èµ–å…³ç³»

```
coldstart
    â”œâ”€â”€ internal/interfaces    # æ¥å£å®šä¹‰
    â”‚   â””â”€â”€ interfaces.go
    â”œâ”€â”€ internal/llm           # LLM å®¢æˆ·ç«¯
    â”‚   â”œâ”€â”€ client.go
    â”‚   â”œâ”€â”€ openai.go
    â”‚   â””â”€â”€ local.go
    â””â”€â”€ pkg/logger             # æ—¥å¿—å·¥å…·
        â””â”€â”€ logger.go
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0.0 | 2026-01-04 | åˆå§‹ç‰ˆæœ¬ |

---

## è´¡çŒ®æŒ‡å—

1. æ–°å¢åŠŸèƒ½éœ€è¦å®ç°ç›¸åº”çš„æ¥å£æ–¹æ³•
2. æ‰€æœ‰å…¬å¼€æ–¹æ³•éœ€è¦æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
3. ä¸ºæ–°åŠŸèƒ½ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•
4. æ›´æ–°æœ¬æ–‡æ¡£

