# 接口设计文档

> 版本: v1.0  
> 更新日期: 2026-01-04  
> 对应架构文档: 《生成式推荐系统架构设计》

---

## 目录

1. [概述](#1-概述)
2. [接口规范](#2-接口规范)
3. [推荐服务接口](#3-推荐服务接口)
4. [用户服务接口](#4-用户服务接口)
5. [物品服务接口](#5-物品服务接口)
6. [特征服务接口](#6-特征服务接口)
7. [冷启动服务接口](#7-冷启动服务接口)
8. [管理后台接口](#8-管理后台接口)

---

## 1. 概述

### 1.1 文档目的

本文档详细定义生成式推荐系统所有对外和内部服务接口，包括请求/响应格式、参数说明、错误码定义等。

### 1.2 接口分类

| 类型 | 协议 | 用途 | 调用方 |
|------|------|------|--------|
| **外部 API** | HTTP REST | 对外提供推荐服务 | 客户端、前端 |
| **内部 RPC** | gRPC | 服务间通信 | 内部微服务 |
| **管理 API** | HTTP REST | 后台管理 | 管理端 |

### 1.3 接口基础信息

| 环境 | Base URL |
|------|----------|
| 开发 | `https://dev-api.example.com/v1` |
| 预发布 | `https://staging-api.example.com/v1` |
| 生产 | `https://api.example.com/v1` |

---

## 2. 接口规范

### 2.1 请求规范

#### 2.1.1 HTTP 请求头

| Header | 必填 | 说明 | 示例 |
|--------|------|------|------|
| `Authorization` | 是 | 认证令牌 | `Bearer eyJhbGc...` |
| `Content-Type` | 是 | 内容类型 | `application/json` |
| `X-Request-ID` | 否 | 请求追踪 ID | `req-uuid-1234` |
| `X-Client-Version` | 否 | 客户端版本 | `1.0.0` |
| `X-Device-ID` | 否 | 设备标识 | `device-uuid` |

#### 2.1.2 通用请求参数

```json
{
  "page": 1,           // 页码，从 1 开始
  "page_size": 20,     // 每页数量，最大 100
  "sort_by": "created_at",  // 排序字段
  "sort_order": "desc" // 排序方向: asc/desc
}
```

### 2.2 响应规范

#### 2.2.1 成功响应

```json
{
  "code": 0,
  "message": "success",
  "data": {
    // 业务数据
  },
  "request_id": "req-uuid-1234",
  "timestamp": 1704355200000
}
```

#### 2.2.2 错误响应

```json
{
  "code": 40001,
  "message": "Invalid parameter: user_id is required",
  "data": null,
  "request_id": "req-uuid-1234",
  "timestamp": 1704355200000,
  "details": {
    "field": "user_id",
    "reason": "required"
  }
}
```

### 2.3 错误码定义

| 错误码范围 | 类别 | 说明 |
|-----------|------|------|
| 0 | 成功 | 请求成功 |
| 40000-40999 | 客户端错误 | 参数错误、认证失败等 |
| 50000-50999 | 服务端错误 | 服务异常、依赖失败等 |
| 60000-60999 | 业务错误 | 业务规则限制 |

#### 详细错误码

| 错误码 | 说明 | HTTP 状态码 |
|--------|------|------------|
| 0 | 成功 | 200 |
| 40001 | 参数错误 | 400 |
| 40002 | 参数格式错误 | 400 |
| 40101 | 未授权 | 401 |
| 40102 | Token 过期 | 401 |
| 40301 | 无权限 | 403 |
| 40401 | 资源不存在 | 404 |
| 42901 | 请求过于频繁 | 429 |
| 50001 | 服务内部错误 | 500 |
| 50002 | 推理服务异常 | 500 |
| 50003 | 数据库异常 | 500 |
| 50301 | 服务不可用 | 503 |
| 60001 | 用户不存在 | 400 |
| 60002 | 物品不存在 | 400 |
| 60003 | 推荐结果为空 | 200 |

---

## 3. 推荐服务接口

### 3.1 生成推荐

生成个性化推荐结果。

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/recommend/generate` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| `user_id` | string | 是 | 用户 ID | `"U123456"` |
| `scene_id` | string | 是 | 场景 ID | `"home_feed"` |
| `count` | int | 否 | 推荐数量，默认 20，最大 100 | `20` |
| `context` | object | 否 | 上下文信息 | 见下方 |
| `filters` | object | 否 | 过滤条件 | 见下方 |
| `boost` | object | 否 | 提权条件 | 见下方 |

**context 对象**

| 参数 | 类型 | 说明 |
|------|------|------|
| `device` | string | 设备类型: mobile/tablet/desktop |
| `location` | string | 位置信息 |
| `time_slot` | string | 时间段: morning/afternoon/evening/night |
| `session_id` | string | 会话 ID |

**filters 对象**

| 参数 | 类型 | 说明 |
|------|------|------|
| `categories` | array | 限定类目 |
| `exclude_items` | array | 排除物品 ID 列表 |
| `price_range` | object | 价格范围 `{min, max}` |
| `tags` | array | 限定标签 |

**boost 对象**

| 参数 | 类型 | 说明 |
|------|------|------|
| `categories` | object | 类目提权 `{"electronics": 1.5}` |
| `items` | object | 物品提权 `{"item123": 2.0}` |
| `freshness` | float | 新鲜度权重 |

#### 请求示例

```json
POST /v1/recommend/generate
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "user_id": "U123456",
  "scene_id": "home_feed",
  "count": 20,
  "context": {
    "device": "mobile",
    "location": "Beijing",
    "time_slot": "evening",
    "session_id": "sess-abc123"
  },
  "filters": {
    "categories": ["electronics", "fashion"],
    "exclude_items": ["item-001", "item-002"],
    "price_range": {
      "min": 100,
      "max": 5000
    }
  },
  "boost": {
    "categories": {
      "electronics": 1.5
    },
    "freshness": 1.2
  }
}
```

#### 响应参数

| 参数 | 类型 | 说明 |
|------|------|------|
| `request_id` | string | 请求 ID，用于追踪和反馈 |
| `items` | array | 推荐物品列表 |
| `metadata` | object | 元数据信息 |

**items 数组元素**

| 参数 | 类型 | 说明 |
|------|------|------|
| `item_id` | string | 物品 ID |
| `title` | string | 物品标题 |
| `cover_url` | string | 封面图 URL |
| `score` | float | 推荐分数 |
| `reason` | string | 推荐理由 |
| `semantic_ids` | array | 语义 ID 序列 |
| `category` | string | 类目 |
| `price` | float | 价格 |
| `extra` | object | 扩展信息 |

**metadata 对象**

| 参数 | 类型 | 说明 |
|------|------|------|
| `algorithm_version` | string | 算法版本 |
| `model_version` | string | 模型版本 |
| `latency_ms` | int | 处理延迟 (ms) |
| `is_fallback` | bool | 是否降级结果 |
| `trace_id` | string | 链路追踪 ID |
| `experiment_id` | string | 实验 ID (A/B测试) |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "request_id": "rec-req-20260104-001",
    "items": [
      {
        "item_id": "item-10001",
        "title": "Apple iPhone 15 Pro Max",
        "cover_url": "https://cdn.example.com/images/iphone15.jpg",
        "score": 0.95,
        "reason": "基于您对电子产品的兴趣",
        "semantic_ids": [23, 456, 7890],
        "category": "electronics/phone",
        "price": 9999.00,
        "extra": {
          "brand": "Apple",
          "rating": 4.9
        }
      },
      {
        "item_id": "item-10002",
        "title": "Sony WH-1000XM5 耳机",
        "cover_url": "https://cdn.example.com/images/sony-headphone.jpg",
        "score": 0.92,
        "reason": "购买手机的用户也喜欢",
        "semantic_ids": [23, 128, 3456],
        "category": "electronics/audio",
        "price": 2499.00,
        "extra": {
          "brand": "Sony",
          "rating": 4.8
        }
      }
    ],
    "metadata": {
      "algorithm_version": "ugt-v3.1",
      "model_version": "ugt-20260101-001",
      "latency_ms": 23,
      "is_fallback": false,
      "trace_id": "trace-abc123",
      "experiment_id": "exp-001"
    }
  },
  "request_id": "req-uuid-1234",
  "timestamp": 1704355200000
}
```

#### 错误响应

| 错误码 | 说明 |
|--------|------|
| 40001 | user_id 或 scene_id 缺失 |
| 60001 | 用户不存在 |
| 60003 | 推荐结果为空 |
| 50002 | 推理服务异常 |

---

### 3.2 实时反馈

上报用户对推荐结果的反馈。

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/recommend/feedback` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `request_id` | string | 是 | 推荐请求 ID |
| `user_id` | string | 是 | 用户 ID |
| `item_id` | string | 是 | 物品 ID |
| `feedback_type` | string | 是 | 反馈类型 |
| `feedback_value` | float | 否 | 反馈值 |
| `position` | int | 否 | 点击位置 |
| `timestamp` | int | 否 | 事件时间戳 (ms) |

**feedback_type 枚举值**

| 值 | 说明 |
|----|------|
| `impression` | 曝光 |
| `click` | 点击 |
| `view` | 浏览 |
| `cart` | 加购 |
| `purchase` | 购买 |
| `favorite` | 收藏 |
| `share` | 分享 |
| `dislike` | 不喜欢 |

#### 请求示例

```json
POST /v1/recommend/feedback
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "request_id": "rec-req-20260104-001",
  "user_id": "U123456",
  "item_id": "item-10001",
  "feedback_type": "click",
  "feedback_value": 1.0,
  "position": 0,
  "timestamp": 1704355210000
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "received": true
  },
  "request_id": "req-uuid-1235",
  "timestamp": 1704355210500
}
```

---

### 3.3 批量推荐

批量为多个用户生成推荐。

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/recommend/batch` |
| Method | `POST` |
| 认证 | 需要 (服务端调用) |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `requests` | array | 是 | 推荐请求数组，最大 100 个 |

#### 请求示例

```json
POST /v1/recommend/batch
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "requests": [
    {
      "user_id": "U123456",
      "scene_id": "home_feed",
      "count": 10
    },
    {
      "user_id": "U123457",
      "scene_id": "home_feed",
      "count": 10
    }
  ]
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "responses": [
      {
        "user_id": "U123456",
        "request_id": "rec-req-20260104-002",
        "items": [...],
        "metadata": {...}
      },
      {
        "user_id": "U123457",
        "request_id": "rec-req-20260104-003",
        "items": [...],
        "metadata": {...}
      }
    ]
  },
  "request_id": "req-uuid-1236",
  "timestamp": 1704355220000
}
```

---

### 3.4 相似推荐

基于物品获取相似推荐。

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/recommend/similar` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `item_id` | string | 是 | 种子物品 ID |
| `user_id` | string | 否 | 用户 ID (用于个性化) |
| `count` | int | 否 | 推荐数量，默认 10 |
| `similarity_type` | string | 否 | 相似度类型 |

**similarity_type 枚举值**

| 值 | 说明 |
|----|------|
| `semantic` | 语义相似 (默认) |
| `collaborative` | 协同相似 |
| `hybrid` | 混合相似 |

#### 请求示例

```json
POST /v1/recommend/similar
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "item_id": "item-10001",
  "user_id": "U123456",
  "count": 10,
  "similarity_type": "hybrid"
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "seed_item": {
      "item_id": "item-10001",
      "title": "Apple iPhone 15 Pro Max"
    },
    "similar_items": [
      {
        "item_id": "item-10003",
        "title": "Apple iPhone 15 Pro",
        "similarity": 0.95,
        "similarity_reason": "同品牌同系列"
      },
      {
        "item_id": "item-10004",
        "title": "Samsung Galaxy S24 Ultra",
        "similarity": 0.82,
        "similarity_reason": "同价位旗舰手机"
      }
    ]
  },
  "request_id": "req-uuid-1237",
  "timestamp": 1704355230000
}
```

---

## 4. 用户服务接口

### 4.1 获取用户信息

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/user/{user_id}` |
| Method | `GET` |
| 认证 | 需要 |

#### 路径参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `user_id` | string | 是 | 用户 ID |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "user_id": "U123456",
    "username": "张三",
    "avatar_url": "https://cdn.example.com/avatars/u123456.jpg",
    "profile": {
      "age_range": "25-34",
      "gender": "male",
      "city": "Beijing"
    },
    "preferences": {
      "categories": ["electronics", "sports"],
      "price_preference": "medium"
    },
    "status": "active",
    "created_at": "2025-01-01T00:00:00Z",
    "last_active_at": "2026-01-04T10:00:00Z"
  },
  "request_id": "req-uuid-1238",
  "timestamp": 1704355240000
}
```

---

### 4.2 获取用户画像

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/user/{user_id}/profile` |
| Method | `GET` |
| 认证 | 需要 |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "user_id": "U123456",
    "basic_profile": {
      "age_range": "25-34",
      "gender": "male",
      "city": "Beijing",
      "education": "bachelor"
    },
    "interest_tags": [
      {"tag": "数码产品", "weight": 0.85},
      {"tag": "运动健身", "weight": 0.72},
      {"tag": "美食", "weight": 0.65}
    ],
    "behavior_summary": {
      "total_clicks": 1234,
      "total_purchases": 56,
      "avg_session_duration": 320,
      "favorite_categories": ["electronics", "sports"]
    },
    "recent_behaviors": [
      {
        "event_type": "view",
        "item_id": "item-10001",
        "timestamp": "2026-01-04T09:30:00Z"
      }
    ],
    "updated_at": "2026-01-04T10:00:00Z"
  },
  "request_id": "req-uuid-1239",
  "timestamp": 1704355250000
}
```

---

### 4.3 记录用户行为

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/user/event` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `user_id` | string | 是 | 用户 ID |
| `event_type` | string | 是 | 事件类型 |
| `item_id` | string | 是 | 物品 ID |
| `event_value` | float | 否 | 事件值 |
| `context` | object | 否 | 上下文信息 |
| `timestamp` | int | 否 | 事件时间戳 |

#### 请求示例

```json
POST /v1/user/event
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "user_id": "U123456",
  "event_type": "view",
  "item_id": "item-10001",
  "event_value": 45.5,
  "context": {
    "device": "mobile",
    "source": "search",
    "keyword": "iPhone"
  },
  "timestamp": 1704355260000
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "event_id": "evt-20260104-001",
    "received": true
  },
  "request_id": "req-uuid-1240",
  "timestamp": 1704355260500
}
```

---

## 5. 物品服务接口

### 5.1 获取物品详情

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/item/{item_id}` |
| Method | `GET` |
| 认证 | 需要 |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "item_id": "item-10001",
    "title": "Apple iPhone 15 Pro Max 256GB",
    "description": "Apple 最新旗舰手机...",
    "cover_url": "https://cdn.example.com/images/iphone15.jpg",
    "images": [
      "https://cdn.example.com/images/iphone15-1.jpg",
      "https://cdn.example.com/images/iphone15-2.jpg"
    ],
    "category_path": "electronics/phone/smartphone",
    "category_ids": [1, 101, 10101],
    "tags": ["旗舰", "5G", "iOS"],
    "attributes": {
      "brand": "Apple",
      "model": "iPhone 15 Pro Max",
      "storage": "256GB",
      "color": "原色钛金属"
    },
    "semantic_ids": [23, 456, 7890],
    "price": 9999.00,
    "original_price": 10999.00,
    "stock": 1000,
    "rating": 4.9,
    "review_count": 12345,
    "status": "active",
    "created_at": "2025-09-15T00:00:00Z",
    "updated_at": "2026-01-04T00:00:00Z"
  },
  "request_id": "req-uuid-1241",
  "timestamp": 1704355270000
}
```

---

### 5.2 批量获取物品

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/item/batch` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `item_ids` | array | 是 | 物品 ID 列表，最大 100 个 |
| `fields` | array | 否 | 返回字段列表 |

#### 请求示例

```json
POST /v1/item/batch
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "item_ids": ["item-10001", "item-10002", "item-10003"],
  "fields": ["item_id", "title", "price", "cover_url"]
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "item_id": "item-10001",
        "title": "Apple iPhone 15 Pro Max",
        "price": 9999.00,
        "cover_url": "https://cdn.example.com/images/iphone15.jpg"
      },
      {
        "item_id": "item-10002",
        "title": "Sony WH-1000XM5",
        "price": 2499.00,
        "cover_url": "https://cdn.example.com/images/sony-headphone.jpg"
      }
    ],
    "missing_ids": ["item-10003"]
  },
  "request_id": "req-uuid-1242",
  "timestamp": 1704355280000
}
```

---

### 5.3 搜索物品

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/item/search` |
| Method | `POST` |
| 认证 | 需要 |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `query` | string | 否 | 搜索关键词 |
| `categories` | array | 否 | 类目过滤 |
| `tags` | array | 否 | 标签过滤 |
| `price_range` | object | 否 | 价格范围 |
| `sort_by` | string | 否 | 排序字段 |
| `page` | int | 否 | 页码 |
| `page_size` | int | 否 | 每页数量 |

#### 请求示例

```json
POST /v1/item/search
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "query": "iPhone",
  "categories": ["electronics/phone"],
  "price_range": {
    "min": 5000,
    "max": 15000
  },
  "sort_by": "popularity",
  "page": 1,
  "page_size": 20
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [...],
    "total": 156,
    "page": 1,
    "page_size": 20,
    "has_more": true
  },
  "request_id": "req-uuid-1243",
  "timestamp": 1704355290000
}
```

---

### 5.4 创建物品

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/item` |
| Method | `POST` |
| 认证 | 需要 (管理权限) |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `title` | string | 是 | 物品标题 |
| `description` | string | 否 | 物品描述 |
| `category_path` | string | 是 | 类目路径 |
| `tags` | array | 否 | 标签列表 |
| `attributes` | object | 否 | 属性信息 |
| `price` | float | 是 | 价格 |
| `cover_url` | string | 否 | 封面图 URL |
| `images` | array | 否 | 图片列表 |

#### 请求示例

```json
POST /v1/item
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "title": "New Product Title",
  "description": "Product description...",
  "category_path": "electronics/phone",
  "tags": ["新品", "热卖"],
  "attributes": {
    "brand": "BrandX",
    "model": "Model Y"
  },
  "price": 1999.00,
  "cover_url": "https://cdn.example.com/images/new-product.jpg"
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "item_id": "item-10100",
    "semantic_ids": [25, 512, 8192],
    "status": "pending_review",
    "created_at": "2026-01-04T10:30:00Z"
  },
  "request_id": "req-uuid-1244",
  "timestamp": 1704355300000
}
```

---

## 6. 特征服务接口

### 6.1 获取用户特征

#### 接口信息 (内部 gRPC)

```protobuf
service FeatureService {
    rpc GetUserFeatures(GetUserFeaturesRequest) returns (UserFeatures);
}

message GetUserFeaturesRequest {
    string user_id = 1;
    repeated string feature_groups = 2;  // profile, behavior, realtime
}

message UserFeatures {
    string user_id = 1;
    map<string, FeatureValue> profile_features = 2;
    map<string, FeatureValue> behavior_features = 3;
    map<string, FeatureValue> realtime_features = 4;
}

message FeatureValue {
    oneof value {
        float float_value = 1;
        int64 int_value = 2;
        string string_value = 3;
        bytes bytes_value = 4;
    }
}
```

#### 调用示例 (Go)

```go
// 获取用户特征
func (s *RecommendService) getUserFeatures(ctx context.Context, userID string) (*pb.UserFeatures, error) {
    req := &pb.GetUserFeaturesRequest{
        UserId: userID,
        FeatureGroups: []string{"profile", "behavior", "realtime"},
    }
    
    resp, err := s.featureClient.GetUserFeatures(ctx, req)
    if err != nil {
        return nil, fmt.Errorf("failed to get user features: %w", err)
    }
    
    return resp, nil
}
```

---

### 6.2 获取物品特征

#### 接口信息 (内部 gRPC)

```protobuf
service FeatureService {
    rpc GetItemFeatures(GetItemFeaturesRequest) returns (ItemFeatures);
    rpc BatchGetItemFeatures(BatchGetItemFeaturesRequest) returns (BatchItemFeatures);
}

message GetItemFeaturesRequest {
    string item_id = 1;
}

message BatchGetItemFeaturesRequest {
    repeated string item_ids = 1;
}

message ItemFeatures {
    string item_id = 1;
    repeated float embedding = 2;
    repeated int32 semantic_ids = 3;
    map<string, FeatureValue> static_features = 4;
    map<string, FeatureValue> dynamic_features = 5;
}

message BatchItemFeatures {
    repeated ItemFeatures items = 1;
}
```

---

## 7. 冷启动服务接口

### 7.1 处理新物品

#### 接口信息 (内部 gRPC)

```protobuf
service ColdStartService {
    rpc ProcessNewItem(ProcessNewItemRequest) returns (ProcessNewItemResponse);
}

message ProcessNewItemRequest {
    string item_id = 1;
    string title = 2;
    string description = 3;
    string category_path = 4;
    bytes image_features = 5;  // 预提取的图像特征
}

message ProcessNewItemResponse {
    string item_id = 1;
    repeated int32 semantic_ids = 2;
    repeated float initial_embedding = 3;
    repeated string similar_items = 4;
    SemanticUnderstanding understanding = 5;
}

message SemanticUnderstanding {
    string primary_category = 1;
    string secondary_category = 2;
    map<string, string> attributes = 3;
    repeated string semantic_tags = 4;
}
```

---

### 7.2 处理新用户

#### 接口信息 (内部 gRPC)

```protobuf
service ColdStartService {
    rpc ProcessNewUser(ProcessNewUserRequest) returns (ProcessNewUserResponse);
}

message ProcessNewUserRequest {
    string user_id = 1;
    map<string, string> registration_info = 2;
    repeated string initial_preferences = 3;
}

message ProcessNewUserResponse {
    string user_id = 1;
    UserProfile initial_profile = 2;
    float exploration_rate = 3;
    repeated string initial_candidates = 4;
}
```

---

## 8. 管理后台接口

### 8.1 仪表盘数据

#### 接口信息

| 属性 | 值 |
|------|-----|
| URL | `/admin/dashboard` |
| Method | `GET` |
| 认证 | 需要 (管理员) |

#### 查询参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `time_range` | string | 否 | 时间范围: 1h/6h/24h/7d/30d |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "realtime_metrics": {
      "current_qps": 45678,
      "p99_latency_ms": 28,
      "error_rate": 0.001,
      "active_users": 123456
    },
    "trend_data": {
      "qps_trend": [
        {"time": "2026-01-04T09:00:00Z", "value": 42000},
        {"time": "2026-01-04T09:05:00Z", "value": 43500}
      ],
      "latency_trend": [
        {"time": "2026-01-04T09:00:00Z", "p50": 12, "p99": 25},
        {"time": "2026-01-04T09:05:00Z", "p50": 13, "p99": 27}
      ]
    },
    "business_metrics": {
      "ctr": 0.0523,
      "cvr": 0.0089,
      "item_coverage": 0.87,
      "user_coverage": 0.95
    },
    "model_info": {
      "current_version": "ugt-20260101-001",
      "last_updated": "2026-01-01T00:00:00Z",
      "next_update": "2026-01-08T00:00:00Z"
    }
  },
  "request_id": "req-uuid-1250",
  "timestamp": 1704355400000
}
```

---

### 8.2 A/B 测试管理

#### 创建实验

| 属性 | 值 |
|------|-----|
| URL | `/admin/experiment` |
| Method | `POST` |
| 认证 | 需要 (管理员) |

#### 请求示例

```json
POST /v1/admin/experiment
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "name": "New Algorithm Test",
  "description": "测试新推荐算法效果",
  "traffic_allocation": {
    "control": 0.5,
    "treatment_a": 0.3,
    "treatment_b": 0.2
  },
  "variants": {
    "control": {
      "algorithm_version": "ugt-v3.0"
    },
    "treatment_a": {
      "algorithm_version": "ugt-v3.1"
    },
    "treatment_b": {
      "algorithm_version": "ugt-v3.1",
      "enable_diversity_boost": true
    }
  },
  "metrics": ["ctr", "cvr", "diversity"],
  "start_time": "2026-01-05T00:00:00Z",
  "end_time": "2026-01-12T00:00:00Z"
}
```

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "experiment_id": "exp-20260105-001",
    "status": "scheduled",
    "created_at": "2026-01-04T11:00:00Z"
  },
  "request_id": "req-uuid-1251",
  "timestamp": 1704355500000
}
```

---

### 8.3 物品管理

#### 物品列表

| 属性 | 值 |
|------|-----|
| URL | `/admin/items` |
| Method | `GET` |
| 认证 | 需要 (管理员) |

#### 查询参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `status` | string | 否 | 状态过滤 |
| `category` | string | 否 | 类目过滤 |
| `keyword` | string | 否 | 关键词搜索 |
| `page` | int | 否 | 页码 |
| `page_size` | int | 否 | 每页数量 |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "item_id": "item-10001",
        "title": "Apple iPhone 15 Pro Max",
        "category_path": "electronics/phone",
        "status": "active",
        "semantic_ids": [23, 456, 7890],
        "impression_count": 123456,
        "click_count": 6543,
        "ctr": 0.053,
        "created_at": "2025-09-15T00:00:00Z"
      }
    ],
    "total": 1000000,
    "page": 1,
    "page_size": 20
  },
  "request_id": "req-uuid-1252",
  "timestamp": 1704355600000
}
```

---

### 8.4 策略配置

#### 更新策略

| 属性 | 值 |
|------|-----|
| URL | `/admin/strategy/{strategy_id}` |
| Method | `PUT` |
| 认证 | 需要 (管理员) |

#### 请求示例

```json
PUT /v1/admin/strategy/recommend_diversify
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  "name": "recommend_diversify",
  "description": "推荐结果多样性策略",
  "enabled": true,
  "config": {
    "diversity_weight": 0.3,
    "category_limit": 5,
    "same_brand_limit": 3
  },
  "effective_time": "2026-01-05T00:00:00Z"
}
```

---

### 8.5 监控告警

#### 告警列表

| 属性 | 值 |
|------|-----|
| URL | `/admin/alerts` |
| Method | `GET` |
| 认证 | 需要 (管理员) |

#### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "alerts": [
      {
        "alert_id": "alert-20260104-001",
        "severity": "warning",
        "title": "推理延迟上升",
        "description": "P99 延迟超过 40ms 阈值",
        "metric": "inference_latency_p99",
        "current_value": 42,
        "threshold": 40,
        "status": "firing",
        "started_at": "2026-01-04T10:30:00Z"
      }
    ],
    "total": 3
  },
  "request_id": "req-uuid-1253",
  "timestamp": 1704355700000
}
```

---

## 附录

### A. 场景 ID 列表

| 场景 ID | 说明 | 默认数量 |
|---------|------|---------|
| `home_feed` | 首页信息流 | 20 |
| `detail_recommend` | 详情页推荐 | 10 |
| `cart_recommend` | 购物车推荐 | 6 |
| `search_recommend` | 搜索结果推荐 | 10 |
| `order_complete` | 订单完成推荐 | 8 |
| `push_notification` | 推送推荐 | 5 |

### B. 事件类型列表

| 事件类型 | 说明 | 反馈价值 |
|----------|------|---------|
| `impression` | 曝光 | 0.1 |
| `click` | 点击 | 1.0 |
| `view` | 浏览 (>3s) | 0.5 |
| `cart` | 加购 | 2.0 |
| `purchase` | 购买 | 5.0 |
| `favorite` | 收藏 | 1.5 |
| `share` | 分享 | 2.0 |
| `dislike` | 不喜欢 | -1.0 |

### C. SDK 使用示例

#### JavaScript SDK

```javascript
import { RecommendClient } from '@recommend-system/js-sdk';

const client = new RecommendClient({
  baseURL: 'https://api.example.com/v1',
  apiKey: 'your-api-key',
});

// 获取推荐
const recommendations = await client.recommend.generate({
  userId: 'U123456',
  sceneId: 'home_feed',
  count: 20,
});

// 上报反馈
await client.recommend.feedback({
  requestId: recommendations.requestId,
  userId: 'U123456',
  itemId: 'item-10001',
  feedbackType: 'click',
});
```

#### Python SDK

```python
from recommend_sdk import RecommendClient

client = RecommendClient(
    base_url='https://api.example.com/v1',
    api_key='your-api-key',
)

# 获取推荐
result = client.recommend.generate(
    user_id='U123456',
    scene_id='home_feed',
    count=20,
)

# 上报反馈
client.recommend.feedback(
    request_id=result.request_id,
    user_id='U123456',
    item_id='item-10001',
    feedback_type='click',
)
```

---

> **文档版本历史**
> - v1.0 (2026-01-04): 初始版本，完整接口设计说明

